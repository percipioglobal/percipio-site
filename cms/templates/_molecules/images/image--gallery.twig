{%- minify -%}

{% set images = content.images %}
{% set caption = content.caption %}

{% set measureImages = [] %}
{% set optimizeIndexes = [] %}

{% for image in images.all() %}
    {% if image.getWidth() > image.getHeight() %}
        {% set measureImages = measureImages|merge(["landscape"]) %}
    {% else %}
        {% set measureImages = measureImages|merge(["portrait"]) %}
    {% endif %}
{% endfor %}

{% for image in measureImages %}
    {% if loop.first %}
        {% if (image != measureImages[loop.index0 + 1])%}
            {% set optimizeIndexes = optimizeIndexes|merge([loop.index0, loop.index0 + 1]) %}
        {% endif %}
    {% elseif loop.index0 is even %}
        {% if (image != measureImages[loop.index0 + 1])%}
            {% set optimizeIndexes = optimizeIndexes|merge([loop.index0, loop.index0 + 1]) %}
        {% endif %}
    {% endif %}
{% endfor %}


{% if images.count() is divisible by(2)  %}
    <div class="{{entry.type == 'blog' ? 'container max-w-5xl my-10 mx-auto' : null }}">
        <div class="flex flex-col-reverse lg:flex-row">
            <div class="lg:text-left w-full lg:w-1/3 lg:mr-3">
                {% if caption %}
                    {{- render.atom('text', 'caption', { caption: caption }) -}}
                {% endif %}
            </div>
            <div class="flex flex-row flex-wrap justify-between grid grid-cols-6 grid-rows-{{ (images.count() / 2) }} grid-flow-row-dense gap-4">
                {% for image in images.all() %}
                    {% if (loop.index0 in optimizeIndexes) and (measureImages[loop.index0] == "portrait") %}
                        <div class="max-w-xs col-span-2">
                            <img src="{{ image.getUrl() }}" >
                        </div>
                    {% elseif (loop.index0 in optimizeIndexes) and (measureImages[loop.index0] == "landscape") %}
                        <div class="max-w-2xl col-span-4">
                            <img src="{{ image.getUrl() }}" >
                        </div>
                    {% else %}
                        <div class="max-w-lg row-end-auto col-span-3">
                            <img src="{{ image.getUrl() }}" >
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
{% endif %}


{%- endminify -%}