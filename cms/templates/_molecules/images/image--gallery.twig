{%- import '_macros/atoms' as render -%}

{%- set columns = 2 -%}

{%- minify -%}

    <div class="my-12 container mx-auto max-w-screen-lg">

        <div class="w-full">
            <div class="grid grid-cols-6 gap-4 w-full">
                {% for image in content.images %}
                    {# options #}
                    {%- set imageSize = image.getWidth() > image.getHeight() ? "landscape" : image.getWidth() - 10 < image.getHeight() and image.getWidth() + 10 > image.getHeight() ? "square" : "portrait" -%} 
                    {%- set siblingImageSize = "" -%}
                    {%- set colspan = "" -%}
                    {%- set ratio = "" -%}

                    {# fetch sibling size #}
                    {%- if loop.index0 % columns == 1 and content.images[loop.index0 - 1] is defined -%}
                        {% if content.images[loop.index0 - 1].getWidth() - 10 < content.images[loop.index0 - 1].getHeight() and  content.images[loop.index0 - 1].getWidth() + 10 > content.images[loop.index0 - 1].getHeight() %}
                            {%- set siblingImageSize = "square" -%}
                        {% elseif content.images[loop.index0 - 1].getWidth() > content.images[loop.index0 - 1].getHeight() %}
                            {%- set siblingImageSize = "landscape" -%}
                        {% else %}
                            {%- set siblingImageSize = "portrait" -%}
                        {% endif %}
                    {%- elseif loop.index0 % columns == 0 and content.images[loop.index0 + 1] is defined -%}
                        {# {%- set siblingImageSize = content.images[loop.index0 + 1].getWidth() > content.images[loop.index0 + 1].getHeight() ? "landscape" : "portrait" -%} #}
                        {% if content.images[loop.index0 + 1].getWidth() - 10 < content.images[loop.index0 + 1].getHeight() and  content.images[loop.index0 + 1].getWidth() + 10 > content.images[loop.index0 + 1].getHeight() %}
                            {%- set siblingImageSize = "square" -%}
                        {% elseif content.images[loop.index0 + 1].getWidth() > content.images[loop.index0 + 1].getHeight() %}
                            {%- set siblingImageSize = "landscape" -%}
                        {% else %}
                            {%- set siblingImageSize = "portrait" -%}
                        {% endif %}
                    {%- endif -%}

                    {# check sibling size to know which format the image should show #}
                    {% if imageSize == siblingImageSize %}
                        {%- set colspan = "3" -%}
                        {%- set ratio = imageSize == "landscape" and siblingImageSize == "landscape" ? "aspect-w-4 aspect-h-3" : imageSize == "portrait" ? "aspect-w-3 aspect-h-4" : "aspect-w-1 aspect-h-1" -%}
                    {% endif %}
                    {% if imageSize == "landscape" and siblingImageSize == "portrait" or imageSize == "landscape" and siblingImageSize == "square" %}
                        {%- set colspan = "4" -%}
                        {%- set ratio = "isFilled" -%}
                    {% endif %}
                    {% if imageSize == "portrait" and siblingImageSize == "landscape" or imageSize == "square" and siblingImageSize == "landscape" %}
                        {%- set colspan = "2" -%}
                        {%- set ratio = imageSize == "portrait" ? "aspect-w-3 aspect-h-4" : "aspect-w-1 aspect-h-1" -%}
                    {% endif %}
                    {% if imageSize == "portrait" and siblingImageSize == "square" or imageSize == "square" and siblingImageSize == "portrait" %}
                        {%- set colspan = "3" -%}
                        {%- set ratio = "aspect-w-1 aspect-h-1" -%}
                    {% endif %}
                    {% if siblingImageSize == "" %}
                        {%- set colspan = "6" -%}
                        {%- set ratio = "aspect-w-16 aspect-h-9" -%}
                    {% endif %}

                    <div class="col-span-6 sm:col-span-{{- colspan -}}">
                        {{- render.atom('image', 'article', {
                            image: image,
                            placeholders: placeholder,
                            alt:image.title,
                            ratio: ratio == "isFilled" ? "w-full h-full" : ratio,
                            utilities: 'overflow-hidden object-cover' ~ (ratio == "isFilled" ? 'w-full h-full top-0 left-0 absolute' : '')  }) -}}
                    </div>
                {% endfor %}
            </div>

            {% if content.caption|length %}
                {{- render.atom('text', 'caption', {
                    caption: content.caption,
                    swatch: swatch ??? null,
                }) -}}
            {% endif %}
        </div>

    </div>

{%- endminify -%}